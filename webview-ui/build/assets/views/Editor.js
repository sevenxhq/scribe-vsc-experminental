import{j as l,b as x,a as r,v as p,r as j,M as h}from"../vscode.js";const g=o=>{const e=[];let t=1,s=!1;return o.split(/\r\n|\n/).forEach(a=>{var n;if(a&&t!==0)if(a.match(/^(\s)*#/gm)){const d=a.match(/# (.*)/);e.push({id:t,title:d==null?void 0:d[1]}),t+=1}else if(a.match(/^(\s)*_/gm)||s===!0){const d=e.findIndex(c=>c.id===t);if(d!==-1&&Object.prototype.hasOwnProperty.call(e[d],"img")&&(e[d].text="",t+=1),a.match(/_(.*)_/g)&&s===!1){const c=a.match(/_(.*)_/);e.push({id:t,end:c==null?void 0:c[1]}),t=0}else if(s=!0,a.match(/^(\s)*_/gm)){const c=a.match(/^(\s)*_(.*)/);e.push({id:t,end:c==null?void 0:c[2]})}else if(a.match(/_$/gm)){const c=a.match(/(.*)_$/);e[t-1].end=`${e[t-1].end}
${c==null?void 0:c[1]}`,t=0}else e[t-1].end=`${e[t-1].end}
${a}`}else if(a.match(/^(\s)*!/gm)){const d=e.findIndex(m=>m.id===t);d!==-1&&Object.prototype.hasOwnProperty.call(e[d],"img")&&(e[d].text="",t+=1);const c=a.match(/\((.*)\)/);e.push({id:t,img:c==null?void 0:c[1]})}else{const d=e.findIndex(c=>c.id===t);d!==-1?(e[d].text=a,t+=1):e[t-2].text=`${(n=e[t-2])==null?void 0:n.text}
${a}`}}),e},w=o=>{let e,t="",s;return o.forEach(a=>{Object.prototype.hasOwnProperty.call(a,"title")&&(e=`# ${a.title.trim()}

`),Object.prototype.hasOwnProperty.call(a,"end")&&(s=`_${a.end.trim()}_`),Object.prototype.hasOwnProperty.call(a,"text")&&(t+=`![OBS Image](${a.img})

${a.text.trim()}

`)}),e+t+s},O=({obsStory:o,setStory:e})=>{console.log(o);const t=s=>{var m,f,u;const i=Number((m=s.target)==null?void 0:m.getAttribute("data-id"))??0,a=(u=(f=s.target)==null?void 0:f.value)==null?void 0:u.toString().replace(/[\n\r]/gm,""),n=o[i-1];let d={};Object.prototype.hasOwnProperty.call(n,"title")?d={id:n.id,title:a}:Object.prototype.hasOwnProperty.call(n,"text")?d={id:n.id,img:n.img,text:a}:Object.prototype.hasOwnProperty.call(n,"end")&&(d={id:n.id,end:a});const c=[...o];c[i-1]=d,e(c)};return l.jsx("div",{className:"flex gap-2 flex-col w-full",children:o.map((s,i)=>l.jsxs("div",{className:"flex items-center w-full",children:[Object.prototype.hasOwnProperty.call(s,"title")&&l.jsx("div",{className:"flex m-4 rounded-md w-full",children:l.jsx(x,{name:s.title,onInput:t,value:s.title,"data-id":s.id,className:"flex-grow text-justify ml-2 p-2 text-xl"})},s.id),Object.prototype.hasOwnProperty.call(s,"text")&&l.jsxs("div",{className:"flex m-4 rounded-md w-full gap-2",children:[l.jsx("span",{className:"w-10 h-10 bg-gray-800 rounded-full flex justify-center text-md text-white items-center p-6 ",children:i}),Object.prototype.hasOwnProperty.call(s,"img")&&l.jsx("div",{className:"rounded-md w-2/5",children:l.jsx("img",{src:s.img,alt:s.title})},s.id),l.jsx(x,{name:s.text,onInput:t,value:s.text,"data-id":s.id,className:" text-justify ml-2 text-sm w-full h-[180px]"})]},s.id),Object.prototype.hasOwnProperty.call(s,"end")&&l.jsx("div",{className:"flex m-4 rounded-md w-full",children:l.jsx(x,{name:s.end,onInput:t,value:s.end,"data-id":s.id,className:"flex-grow text-justify ml-2 text-sm h-full"})},s.id)]}))})},y=()=>{const[o,e]=r.useState(null),[t,s]=r.useState(!1);return r.useEffect(()=>{p.setMessageListeners(i=>{switch(console.log("in update",i.data),i.data.type){case"update":e(i.data.payload.doc),s(i.data.payload.isReadonly);break}})},[]),{document:o,isReadonly:t}},b=({obsStory:o})=>l.jsx("div",{className:"flex gap-2 flex-col w-full",children:o.map((e,t)=>l.jsxs("div",{className:"flex items-center w-full",children:[Object.prototype.hasOwnProperty.call(e,"title")&&l.jsx("div",{className:"flex m-4 rounded-md w-full",children:l.jsx("h1",{className:"text-[color:var(--vscode-descriptionForeground)] flex-grow text-justify ml-2 p-2 text-xl",children:e.title})},e.id),Object.prototype.hasOwnProperty.call(e,"text")&&l.jsxs("div",{className:"flex m-4 rounded-md w-full gap-2",children:[l.jsx("span",{className:"w-10 h-10 bg-gray-800 rounded-full flex justify-center text-md text-white items-center p-6 ",children:t}),Object.prototype.hasOwnProperty.call(e,"img")&&l.jsx("div",{className:"rounded-md w-2/5",children:l.jsx("img",{src:e.img,alt:e.title})},e.id),l.jsx("p",{className:"text-[color:var(--vscode-descriptionForeground)]  text-justify ml-2 text-sm w-full ",children:e.text})]},e.id),Object.prototype.hasOwnProperty.call(e,"end")&&l.jsx("div",{className:"flex m-4 rounded-md w-full",children:l.jsx("footer",{className:"text-[color:var(--vscode-descriptionForeground)] flex-grow text-justify ml-2 text-sm h-full",children:e.end})},e.id)]}))});function v(){const[o,e]=r.useState([]),{document:t,isReadonly:s}=y();r.useEffect(()=>{p.setMessageListeners()},[]),r.useEffect(()=>{t&&e(g(t??""))},[t]);const i=n=>{e(n);const d=w(n);p.postMessage({type:h.save,payload:d})},[,a]=r.useState(null);return s?l.jsx("div",{className:"card",children:l.jsx(b,{obsStory:o})}):l.jsx(l.Fragment,{children:l.jsxs("div",{className:"card",children:[l.jsx("input",{type:"file",onInput:n=>{var c;const d=(c=n.target.files)==null?void 0:c[0];d&&(a(d),console.log(d),p.postMessage({type:h.openResource,payload:{path:d.path}}))}}),l.jsx("div",{children:l.jsx(O,{obsStory:o,setStory:i})})]})})}j(l.jsx(v,{}));
